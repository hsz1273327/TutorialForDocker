# 容器调用外设

通常我们不用docker部署那些需要访问外部挂载外设的服务,不过并不是不能.

容器中使用外设可以分为两种:

1. 容器访问外设,典型的就是调用usb摄像头,调用扩音器等.这种方式通过`devices`字段挂载.我们以调用usb摄像头为例
2. 容器访问gpu.这种只能通过设置docker配置中的`runtimes`配合专用的基镜像来使用

## 调用usb摄像头

容器调用摄像头的前提是宿主机上有usb摄像头.

为了验证我们的宿主机上usb摄像头已经安装完成我们需要ssh可以看远程机器上传过来的视频信号

### usb设备机器上的准备工作

1. 在服务器端配置`/etc/ssh/sshd_config`

    ```txt
    X11Forwarding yes
    X11DisplayOffset 10
    PrintMotd no
    PrintLastLog yes
    TCPKeepAlive yes
    ```

### mac上的准备工作

1. 安装[libsdl](http://www.libsdl.org/download-2.0.php),下载好后按readme中写的方式将文件夹`SDL2.framework`放入`/Library/Frameworks`
2. 安装[xquartz](https://www.xquartz.org/)下载好后双击安装
3. 打开`xquartz`

### 验证摄像头可用

通过`xquartz`的terminal我们用ssh访问挂着摄像头的宿主机,之后:

1. 查看摄像头路径`ls /dev/video*`我们可以看到摄像头路径为`/dev/video0`
2. 查看摄像头信息`lsusb`,可以看到我们usb设备的信息
3. 安装camorama,`sudo apt-get install camorama`
4. 执行`camorama -d /dev/video0`我们就可以在自己的机器上通过摄像头挂载的宿主机看到摄像头捕获的视频了

### 容器挂载摄像头

我们使用如下compose文件部署一个debian的镜像

```yml

```

## docker容器调用gpu

,但在`docker 19.03`之前如果我们想使用gpu,那么我们必须使用`nvidia-docker`这个docker的实现,而在之后docker已经原生支持gpu了,我们可以声明`nvidia-container-runtime`的位置来直接支持使用gpu.本文以`docker 19.03`以后的版本为准,因此就不介绍`nvidia-docker`了.