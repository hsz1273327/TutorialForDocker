# 结语

## 选择合适的技术很重要

很多人技术选型时会纠结用不用容器技术,用docker还是podman,要不要用集群,用docker swarm还是用k8s.网上也铺天盖地的各种对比文章.但实际上技术选型更多的是要综合自身条件而非简单的对比产品功能.

任何软件产品永远是在功能,性能,使用成本,维护成本这4个维度间寻找平衡,软件工程领域从来没有银弹.因此技术选型其实并不是一个静态的过程,而是一个规划,一个路线图.而且这个规划需要随着业务的发展不断进行修正,是个渐进的过程.

当你的业务单应用就搞定时还有什么必要用docker?当你的业务单机就搞定时还有什么必要用集群?当你的业务不赚钱,时还有什么必要扩展那些周边的辅助工具呢?

说完技术选型的思路接着说说k8s和swarm的选择.

这俩都是集群,但思路差距极大,我们知道几乎所有东西随着规模的扩大管理成本会逐渐超过资源本身的成本.而容器集群技术就是用于降低服务实例规模扩大造成的管理成本扩大的技术手段.k8s和swarm在上面提到的4个维度中选择正好相反

+ swarm选择了使用成本和维护成本
+ k8s选择了功能和性能

k8s的功能更加全面,配置可以更加细致,而swarm则极易上手,也几乎没有额外的维护成本.可以认为k8s更好但更难用,使用它的沉默成本更高;swarm则更好用但上线更低并不适合作为最终方案.因此如果公司没啥资金而且前途并不明朗,而技术人员没有k8s相关的技术积累,swarm其实反而是更好的选择.当swarm无法满足你的需要时相信你也已经熟悉了集群化容器的使用工作流,再转去k8s也不会那么难.

## 开源小公司真的不容易

Docker是个伟大的产品,但docker公司确是个悲剧的公司.在2013年Docker横空出世,凭借一次编译处处部署的特性迅速占领市场,使大家第一次认识了容器化技术,也定型了容器技术的基本形态.即便到了如今的2020年,docker依然是容器技术的代名词,占据超过70%的市场分额.但是,回头看看如今的docker,实际上它就只剩下了名字和壳了.而docker公司的企业业务也被Mirantis收购了.

以Docker为首的开源厂商,既是创业公司又是开源先锋.这类公司往往能收获来自开发者的追捧,却在挣钱这件大事儿上发不出强有力的声音.

即便是在开源领域,Docker也相当憋屈.2015年和coreos以及其他容器相关公司构建了OCI,把自家的镜像格式和运行时`runc`捐了作为OCI的启动资源.17年又把从v1.11起开始引入的容器运行时 `containerd`捐给了CNCF.而如今`containerd`被其集群化工具swarm的主要竞争对手k8s使用,而就在2020年的12月2日,k8s宣布新版本将弃用`docker shim`这个k8s到dockerd的垫片,也就是说k8s将不再支持docker部署容器.想想这个感觉,就像是自己儿子被自己打造的宝剑砍死了.

类似的境遇在开源Web服务器`Nginx`上也有出现.`Nginx`在世界范围内一直有着大量的忠实企业,个人用户.因为其占有内存少,并发能力强的特性全球范围内有超过3.74亿的网站在使用Nginx.任谁看到这样骄人的数据都会认为这家公司欣欣向荣,前景光明.然而现实是今年Nginx卖身给了自己的竞争对手F5,作价仅仅6.7亿美元,比其自己叫价的7亿美元还低了3千万.

从纯开源模式起家,到做出商业化的探索,再到最终的贱卖于大体量厂商,这是似乎成了开源软件厂商宿命般的归宿.

开源的最大受益者是谁?开发者,中小型公司,还有那些被开源厂商视作吸血鬼的云厂商.但唯独开源厂商自己并不是大的受益人.真是有钱男子汉没钱汉子难呀.

而在这之外开源又似乎成了一种救赎,即便公司没了,但它的产品却可以永葆活力.只是开源小公司真的太不容易了!