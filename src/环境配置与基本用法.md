# Docker环境的安装

可以去[官网下载安装工具](https://www.docker.com/),不过国内在墙里,所以更加推荐使用Dao云等工具,
这边以[Dao云](https://dashboard.daocloud.io/)为例,人肉翻墙的同学们就不要嘚瑟了...老实按官网的来就好,
dao云主要也就是提供了一个dockerhub上不受墙限制的镜像下载工具而已.

进去我的集群后添加主机,选择你额系统版本,之后就是简单的按步骤做而已.

## 确认Docker服务器已经启动

Docker的服务是守护进程执行的,我们可以在宿主机中使用

    sudo status docker

来查看是否已经启动(mac没有这个命令),更常用的方法是使用

    docker info

命令来确认是否已经可以使用

**需要注意的是**
mac下因为实际docker是跑在vm上,所以必须使用Boot2Docker,如果是按照官方的或者Dao云的方式安装的话,则是需要使用
`Docker Quickstart Terminal`才能进入vm中与docker交互

# 基本用法

## 第一个容器

使用`docker run`命令来创建并启动容器.它依赖于镜像,如果没有镜像,它会默认从docker hub下载.

> 例: 使用Ubuntu的镜像

```shell
docker run -i -t ubuntu /bin/bash
```
这条命令有两个参数:

+ -i:表示STDIN是开启的
+ -t:表示要为容器分配一个伪tty终端

有了这两个参数,我们就可以使用它的命令行交互了

接着参数ubuntu说明要使用的是ubuntu这个镜像,像ubuntu是一个常备镜像,和它类似的还有debian呀centos啥的.我们一般都会基于常备镜像构建自己的镜像

接着就是就是告诉docker我们要什么命令,这个例子中使用/bin/bash这个命令

全跑完后我们就可以和这个容器交互了

```shell
# hostname
```
可以看到主机名已经是容器的id了,我们给ubuntu安装个vim

```shell
apt-get update && apt-get install vim
```
我们要退出的话直接用exit就可以退出到宿主机的交互界面了,就和用ssh连接远程服务器差不多

## 为容器命名

在run命令后面可以使用`--name <name>`来给我们的容器命名,被命名的容器可以代替容器ID

```shell
docker run --name hsz_ubuntu -i -t ubuntu /bin/bash
```
容器的命名必须是唯一的,

## 启动和重启容器

run命令常用来进入容器做操作,而start和restart命令则用来启动或重启容器,这种运行方式并不能进入交互,而是启动这个容器,一般是封装好了后执行用的.它会沿用run命令时指定的参数运行.在mac下它会成为守护进程执行,但可以用kitematic中的exec按钮开启一个额外的命令行进程访问.与之相对的是stop命令.他可以停止容器执行.

我们也可以使用atttach命令重新附着到正在运行中的容器上实现会话,需要额外一次回车,这样就可以进入容器中了

```shell
docker attach hsz_ubuntu
```

## 守护进程容器

很多时候我们并不想用交互界面,而是希望应用一直长期运行,这种时候我们就需要守护进程容器啦

使用方法很简单,就是给run 命令后面加上-d而已

```shell
docker run -d --name hsz_ubuntu_d -i -t ubuntu /bin/bash -c "while true;do echo hello; sleep 1; done"
```

我们可以在`kitematic`中看到每隔1s就刷出一个hello来,当然不能老这样了,我们用stop命令把它停掉

### log

如果要看log信息的话我们可以使用logs命令查看

```shell
docker logs --tail 10 hsz_ubuntu_d
```

这样就可以看到尾巴后面10条的信息了

有时候我们想调试,那就用-t参数,它可以为每条日志加上时间戳,用-f参数追踪最新的信息

我们有时候希望从外部知道守护进程容器内部的进程情况,这时候可以使用

```shell
docker top hsz_ubuntu_d
```
这样就可以查看到PID USER COMMAND的信息了

### 开启新进程

我们用exec来开启新的进程,它的参数和run差不多,-d是守护进程,-t是tty,-i是捕捉STDIN


### 自动重启容器

我们可以在run命令后面加上参数 `--restart=<flag>` 来让容器在出错时自动重启,它可以带的参数有:

+ always: 表示无论退出代码是啥都会自动重启
+ on-failure[:<int>]:  只有容器退出代码为非0值时才会重启,后面的可选项是重启此时设定

## 查看容器信息

`inspect`命令可以查看容器的信息,后面带参数-f则可以规定输出格式,它支持go语言的模板

## 删除容器

`rm`命令是用来删除容器的,运行中的容器无法删除.

要删除容器首先我们要找到容器的对应id,通过

`docker ps -a`来查看所有docker的信息,之后找到要删的使用
`docker rm <id>`即可.

其中-a代表详细信息,类似ls中的-a

### 全部删除

当然了这么做很危险,官方也不推荐所以没有对应的操作,但可以用
```shell
docker rm `docker ps -a -q`
```
来实现,其中-q代表只返回id

## 查看容器

说明|命令
---|---
列出当前所有正在运行的container|docker ps
列出所有的container|docker ps -a
列出最近一次启动的container|docker ps -l
